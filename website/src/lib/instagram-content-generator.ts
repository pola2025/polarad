/**
 * Instagram ì»¨í…ì¸  ìƒì„±ê¸°
 * polarad.co.kr ê¸°ë°˜ ì»¨í…ì¸  ìƒì„±
 *
 * âš ï¸ GEMINI ëª¨ë¸ ì ˆëŒ€ê·œì¹™ (ë³€ê²½ ê¸ˆì§€) âš ï¸
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * | ìš©ë„           | ëª¨ë¸                          |
 * |----------------|-------------------------------|
 * | í…œí”Œë¦¿ ë°ì´í„°  | gemini-3-flash-preview        |
 * | ìº¡ì…˜ ìƒì„±      | gemini-3-pro-preview          |
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * âŒ Gemini 2.x ë²„ì „ ì‚¬ìš© ì ˆëŒ€ ê¸ˆì§€
 * âŒ ëª¨ë¸ëª… ì„ì˜ ë³€ê²½ ê¸ˆì§€
 */

import { TemplateData, TemplateType, TEMPLATE_TYPES } from './instagram-templates';

const GEMINI_API_KEY = process.env.GEMINI_API_KEY;

// polarad.co.kr ì„œë¹„ìŠ¤ ë‚´ìš© ê¸°ë°˜ ì»¨í…ì¸  í’€
// DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ - 36ë§Œì› ë‹¨ì¼ ìƒí’ˆ ê¸°ë°˜
const CONTENT_TOPICS = {
  intro: {
    themes: [
      'ì›” 3ë§Œì›ìœ¼ë¡œ 1ë…„ ìë™í™”',
      'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì§„ì„± ë¦¬ë“œë§Œ ìˆ˜ì§‘',
      '5~7ì¼ ë§Œì— ì™„ì„±ë˜ëŠ” ë¦¬ë“œ ìˆ˜ì§‘ ì‹œìŠ¤í…œ',
      'ìŠ¤íŒ¸ ì—†ëŠ” ì§„ì§œ ê³ ê°ë§Œ ë°›ëŠ” ëœë”©í˜ì´ì§€',
    ],
    services: ['ëœë”©í˜ì´ì§€', 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸', 'í…”ë ˆê·¸ë¨ ì•Œë¦¼', 'ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ'],
  },
  problem: {
    painPoints: [
      'ìŠ¤íŒ¸ ì ‘ìˆ˜ë¡œ ì‹œê°„ ë‚­ë¹„',
      'ê°€ì§œ ì „í™”ë²ˆí˜¸ë¡œ ì—°ë½ ì•ˆ ë¨',
      'ë°˜ë³µ ì ‘ìˆ˜ë¡œ ì¤‘ë³µ DB',
      'ì ‘ìˆ˜ ì•Œë¦¼ì´ ëŠ¦ì–´ì„œ ë†“ì¹¨',
      'ê³ ê° ë°ì´í„° ê´€ë¦¬ê°€ ì•ˆ ë¼ì„œ',
      'ì—‘ì…€ë¡œ ì¼ì¼ì´ ì •ë¦¬í•˜ëŠë¼',
    ],
    questions: [
      'ì•„ì§ë„ ìŠ¤íŒ¸ ì ‘ìˆ˜ ë•Œë¬¸ì— ì‹œê°„ ë‚­ë¹„í•˜ê³  ê³„ì‹­ë‹ˆê¹Œ?',
      'ê°€ì§œ ì „í™”ë²ˆí˜¸ ë•Œë¬¸ì— ì—°ë½ì´ ì•ˆ ë˜ì…¨ë‚˜ìš”?',
      'ì ‘ìˆ˜ ì•Œë¦¼ì´ ëŠ¦ì–´ì„œ ê³ ê°ì„ ë†“ì¹˜ì…¨ë‚˜ìš”?',
      'ì—‘ì…€ë¡œ DB ì •ë¦¬í•˜ëŠë¼ ì‹œê°„ ë‹¤ ì“°ì‹œë‚˜ìš”?',
    ],
  },
  solution: {
    product: {
      name: 'DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤',
      price: '36ë§Œì›',
      monthly: 'ì›” 3ë§Œì›',
      period: '1ë…„ ì´ìš©ê¶Œ',
    },
    benefits: [
      'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ë³¸ì¸ì¸ì¦ëœ ì •ë³´ë§Œ ìˆ˜ì§‘',
      'ìŠ¤íŒ¸/ë°˜ë³µ ì ‘ìˆ˜ ìë™ ì°¨ë‹¨',
      'í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì¦‰ì‹œ ì•Œë¦¼',
      'ê´€ë¦¬ ëŒ€ì‹œë³´ë“œì—ì„œ í•œëˆˆì— í™•ì¸',
    ],
    keyMessages: [
      'ì§„ì„± ë¦¬ë“œë§Œ ìˆ˜ì§‘í•˜ì„¸ìš”',
      'ì›” 3ë§Œì›ìœ¼ë¡œ 1ë…„ê°„ ìë™í™”',
      '5~7ì¼ ë§Œì— ì œì‘ ì™„ë£Œ',
      'ìŠ¤íŒ¸ ê±±ì • ì—†ì´ ì˜ì—…ì—ë§Œ ì§‘ì¤‘',
    ],
  },
  feature: {
    features: [
      { name: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸', desc: 'ë³¸ì¸ì¸ì¦ëœ ì—°ë½ì²˜ë§Œ ìˆ˜ì§‘' },
      { name: 'ìŠ¤íŒ¸ ì°¨ë‹¨', desc: 'ë°˜ë³µì ‘ìˆ˜/ê°€ì§œë²ˆí˜¸ ìë™ í•„í„°' },
      { name: 'í…”ë ˆê·¸ë¨ ì•Œë¦¼', desc: 'ì ‘ìˆ˜ ì¦‰ì‹œ ì‹¤ì‹œê°„ ì•Œë¦¼' },
      { name: 'ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ', desc: 'ì ‘ìˆ˜ í˜„í™© í•œëˆˆì— íŒŒì•…' },
    ],
  },
  stats: {
    metrics: [
      { label: 'ìŠ¤íŒ¸ ì°¨ë‹¨ìœ¨', range: [95, 99], unit: '%' },
      { label: 'ì—°ë½ ì„±ê³µë¥ ', range: [85, 95], unit: '%' },
      { label: 'í‰ê·  ì œì‘ ê¸°ê°„', value: '5~7ì¼' },
      { label: 'ì›” ë¹„ìš©', value: '3ë§Œì›' },
    ],
  },
  promo: {
    offers: [
      '36ë§Œì›ì— 1ë…„ ì™„ì „ ìë™í™”!',
      'ì›” 3ë§Œì›ì´ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤!',
      '5~7ì¼ ë‚´ ì œì‘ ì™„ë£Œ!',
      'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ìŠ¤íŒ¸ ì œë¡œ!',
    ],
    benefits: [
      'ë§ì¶¤í˜• ëœë”©í˜ì´ì§€ ì œì‘',
      'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—°ë™',
      'í…”ë ˆê·¸ë¨ ì‹¤ì‹œê°„ ì•Œë¦¼',
      'ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ ì œê³µ',
      '1ë…„ ìš´ì˜ í¬í•¨',
    ],
  },
  service: {
    services: [
      {
        name: 'ëœë”©í˜ì´ì§€ ì œì‘',
        features: [
          { name: 'ë§ì¶¤ ë””ìì¸', desc: 'ì—…ì¢…ì— ë§ëŠ” ì „í™˜ ìµœì í™”' },
          { name: 'ëª¨ë°”ì¼ ìµœì í™”', desc: 'PC, ëª¨ë°”ì¼ ì™„ë²½ ëŒ€ì‘' },
          { name: 'DB í¼ ì—°ë™', desc: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê¸°ë°˜ ìˆ˜ì§‘' },
        ],
      },
      {
        name: 'ì ‘ìˆ˜ ìë™í™”',
        features: [
          { name: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸', desc: 'ë³¸ì¸ì¸ì¦ëœ ì •ë³´ë§Œ ìˆ˜ì§‘' },
          { name: 'ìŠ¤íŒ¸ í•„í„°', desc: 'ë°˜ë³µ/ê°€ì§œ ì ‘ìˆ˜ ìë™ ì°¨ë‹¨' },
          { name: 'ì¤‘ë³µ ë°©ì§€', desc: 'ê°™ì€ ê³ ê° ì¤‘ë³µ ì ‘ìˆ˜ ì°¨ë‹¨' },
        ],
      },
      {
        name: 'ì•Œë¦¼ & ê´€ë¦¬',
        features: [
          { name: 'í…”ë ˆê·¸ë¨ ì•Œë¦¼', desc: 'ì ‘ìˆ˜ ì¦‰ì‹œ ì‹¤ì‹œê°„ ì•Œë¦¼' },
          { name: 'ëŒ€ì‹œë³´ë“œ', desc: 'ì ‘ìˆ˜ í˜„í™© í•œëˆˆì— íŒŒì•…' },
          { name: 'ë°ì´í„° ê´€ë¦¬', desc: 'ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì§€ì›' },
        ],
      },
    ],
  },
  cta: {
    messages: [
      'ì˜ì—…ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”',
      'ìŠ¤íŒ¸ ê±±ì •ì€ ì´ì œ ë',
      'ì§„ì„± ë¦¬ë“œë§Œ ë°›ìœ¼ì„¸ìš”',
      'ì›” 3ë§Œì›ìœ¼ë¡œ 1ë…„ ìë™í™”',
    ],
  },
  case: {
    cases: [
      {
        industry: 'ê²½ì˜ì»¨ì„¤íŒ…',
        period: '1ê°œì›”',
        stats: [
          { label: 'ì´ ì ‘ìˆ˜', value: '127ê±´', change: 'ì›” í‰ê· ' },
          { label: 'ìŠ¤íŒ¸ ì°¨ë‹¨', value: '98%', change: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸' },
          { label: 'ì—°ë½ ì„±ê³µ', value: '92%', change: 'ë³¸ì¸ì¸ì¦ íš¨ê³¼' },
        ],
        quote: 'ìŠ¤íŒ¸ ì—†ì´ ì§„ì§œ ê³ ê°ë§Œ ë°›ìœ¼ë‹ˆ ì˜ì—… íš¨ìœ¨ì´ í™• ì˜¬ëìŠµë‹ˆë‹¤',
      },
      {
        industry: 'ì¸í…Œë¦¬ì–´',
        period: '2ê°œì›”',
        stats: [
          { label: 'ì´ ì ‘ìˆ˜', value: '89ê±´', change: 'ì›” í‰ê· ' },
          { label: 'ìŠ¤íŒ¸ ì°¨ë‹¨', value: '97%', change: 'ë°˜ë³µ ì ‘ìˆ˜ ì°¨ë‹¨' },
          { label: 'ê³„ì•½ ì „í™˜', value: '15ê±´', change: 'ì „í™˜ìœ¨ 17%' },
        ],
        quote: 'ê°€ì§œ ë²ˆí˜¸ ì—†ì´ ì—°ë½ì´ ë‹¤ ë˜ë‹ˆê¹Œ ì‹œê°„ ë‚­ë¹„ê°€ ì—†ì–´ìš”',
      },
      {
        industry: 'êµìœ¡ì„œë¹„ìŠ¤',
        period: '1ê°œì›”',
        stats: [
          { label: 'ì´ ì ‘ìˆ˜', value: '156ê±´', change: 'ì›” í‰ê· ' },
          { label: 'ìŠ¤íŒ¸ ì°¨ë‹¨', value: '99%', change: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸' },
          { label: 'ë“±ë¡ ì™„ë£Œ', value: '23ëª…', change: 'ì „í™˜ìœ¨ 15%' },
        ],
        quote: 'í…”ë ˆê·¸ë¨ ì•Œë¦¼ìœ¼ë¡œ ë°”ë¡œ ì—°ë½í•˜ë‹ˆ ë“±ë¡ë¥ ì´ í™• ì˜¬ëìŠµë‹ˆë‹¤',
      },
    ],
    ctaMessages: [
      'ë‹¤ìŒ ì„±ê³µ ì‚¬ë¡€ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”',
      'ì›” 3ë§Œì›ìœ¼ë¡œ ì´ëŸ° ì„±ê³¼ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”',
      'ìŠ¤íŒ¸ ì—†ëŠ” ì§„ì„± ë¦¬ë“œë§Œ ë°›ì•„ë³´ì„¸ìš”',
    ],
  },
};

// í•´ì‹œíƒœê·¸ í’€ - DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ ê¸°ë°˜
const HASHTAG_POOLS = {
  core: ['#í´ë¼ì• ë“œ', '#polarad', '#DBìˆ˜ì§‘', '#ë¦¬ë“œìˆ˜ì§‘', '#ì˜ì—…ìë™í™”'],
  service: ['#ëœë”©í˜ì´ì§€', '#ì¹´ì¹´ì˜¤ë¡œê·¸ì¸', '#í…”ë ˆê·¸ë¨ì•Œë¦¼', '#ë¦¬ë“œì œë„ˆë ˆì´ì…˜', '#ì ‘ìˆ˜ìë™í™”'],
  target: ['#B2Bë§ˆì¼€íŒ…', '#ì†Œìƒê³µì¸', '#ì¤‘ì†Œê¸°ì—…', '#ì˜ì—…ëŒ€í‘œ', '#ì„¸ì¼ì¦ˆ', '#ì‚¬ì—…ì'],
  feature: ['#ìŠ¤íŒ¸ì°¨ë‹¨', '#ë³¸ì¸ì¸ì¦', '#ì‹¤ì‹œê°„ì•Œë¦¼', '#ëŒ€ì‹œë³´ë“œ', '#ì—…ë¬´íš¨ìœ¨'],
};

interface GeneratedContent {
  templateType: TemplateType;
  templateData: TemplateData;
  caption: string;
  hashtags: string[];
}

/**
 * Geminië¡œ Instagram ì»¨í…ì¸  ìƒì„±
 */
export async function generateInstagramContent(): Promise<GeneratedContent> {
  // ëœë¤ í…œí”Œë¦¿ íƒ€ì… ì„ íƒ
  const templateType = TEMPLATE_TYPES[Math.floor(Math.random() * TEMPLATE_TYPES.length)];

  // Geminië¡œ ì»¨í…ì¸  ìƒì„±
  const templateData = await generateContentWithGemini(templateType);

  // ìº¡ì…˜ ìƒì„±
  const caption = await generateCaptionWithGemini(templateType, templateData);

  // í•´ì‹œíƒœê·¸ ì„ íƒ
  const hashtags = selectHashtags(templateType);

  return {
    templateType,
    templateData,
    caption,
    hashtags,
  };
}

/**
 * Geminië¡œ í…œí”Œë¦¿ ë°ì´í„° ìƒì„± (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
 */
async function generateContentWithGemini(templateType: TemplateType): Promise<TemplateData> {
  if (!GEMINI_API_KEY) {
    console.log('âš ï¸ GEMINI_API_KEY ë¯¸ì„¤ì • - ê¸°ë³¸ ì»¨í…ì¸  ì‚¬ìš©');
    return getDefaultContent(templateType);
  }

  const topic = CONTENT_TOPICS[templateType];
  const prompt = buildPromptForTemplate(templateType, topic);

  // ìµœëŒ€ 2ë²ˆ ì¬ì‹œë„
  for (let attempt = 1; attempt <= 2; attempt++) {
    try {
      console.log(`ğŸ¤– Gemini í…œí”Œë¦¿ ë°ì´í„° ìƒì„± ì¤‘... (ì‹œë„ ${attempt}/2)`);
      
      const res = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${GEMINI_API_KEY}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: {
              temperature: 0.7, // ì•½ê°„ ë‚®ì¶°ì„œ ë” ì•ˆì •ì ì¸ JSON ìƒì„±
              maxOutputTokens: 1000,
            },
          }),
        }
      );

      if (!res.ok) {
        console.error(`âŒ Gemini API ì˜¤ë¥˜ (ì‹œë„ ${attempt}): ${res.status}`);
        continue;
      }

      const result = await res.json();
      const responseText = result.candidates?.[0]?.content?.parts?.[0]?.text?.trim();

      if (!responseText) {
        console.error(`âŒ Gemini ì‘ë‹µ ë¹„ì–´ìˆìŒ (ì‹œë„ ${attempt})`);
        continue;
      }

      // íŒŒì‹± ì‹œë„
      const parsed = parseGeminiResponse(templateType, responseText);
      
      // íŒŒì‹± ì„±ê³µ ì—¬ë¶€ í™•ì¸ (ê¸°ë³¸ê°’ì´ ì•„ë‹Œ ê²½ìš°)
      const defaultContent = getDefaultContent(templateType);
      if (parsed.headline !== defaultContent.headline) {
        console.log(`âœ… Gemini í…œí”Œë¦¿ ë°ì´í„° ìƒì„± ì„±ê³µ (ì‹œë„ ${attempt})`);
        return parsed;
      }
      
      console.warn(`âš ï¸ Gemini íŒŒì‹± ì‹¤íŒ¨ë¡œ í´ë°±ë¨ (ì‹œë„ ${attempt})`);
      
    } catch (error) {
      console.error(`âŒ Gemini ì»¨í…ì¸  ìƒì„± ì‹¤íŒ¨ (ì‹œë„ ${attempt}):`, error);
    }

    // ì¬ì‹œë„ ì „ ëŒ€ê¸°
    if (attempt < 2) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }

  console.log('âš ï¸ ëª¨ë“  Gemini ì‹œë„ ì‹¤íŒ¨ - ê¸°ë³¸ ì»¨í…ì¸  ì‚¬ìš©');
  return getDefaultContent(templateType);
}

/**
 * í…œí”Œë¦¿ íƒ€ì…ë³„ í”„ë¡¬í”„íŠ¸ ìƒì„±
 */
function buildPromptForTemplate(templateType: TemplateType, topic: any): string {
  const baseContext = `ë‹¹ì‹ ì€ PolarAD(í´ë¼ì• ë“œ)ì˜ Instagram ì»¨í…ì¸  ì‘ì„±ìì…ë‹ˆë‹¤.
PolarADëŠ” B2B ì˜ì—… ëŒ€í‘œë‹˜ë“¤ì„ ìœ„í•œ "DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤"ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

**í•µì‹¬ ìƒí’ˆ: DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ 36ë§Œì› (VAT ë³„ë„)**
- ì›” 3ë§Œì› / 1ë…„ ì´ìš©ê¶Œ
- ë§ì¶¤í˜• ëœë”©í˜ì´ì§€ ì œì‘
- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—°ë™ (ìŠ¤íŒ¸ ì°¨ë‹¨, ë³¸ì¸ì¸ì¦)
- í…”ë ˆê·¸ë¨ ì‹¤ì‹œê°„ ì•Œë¦¼
- ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ ì œê³µ
- 5~7ì¼ ë‚´ ì œì‘ ì™„ë£Œ
- ìˆ˜ì • ìš”ì²­: ê±´ë‹¹ 3ë§Œì›
- 1ë…„ í›„ ì—°ì¥: ì›” 1ë§Œì›

ğŸš« **[ì ˆëŒ€ ê¸ˆì§€] ë‹¤ìŒ ë‚´ìš©ì€ ì ˆëŒ€ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”:**
- Meta ê´‘ê³ , Facebook ê´‘ê³ , Instagram ê´‘ê³  ê´€ë ¨ ë‚´ìš©
- í™ˆí˜ì´ì§€ ì œì‘ (10í˜ì´ì§€, 5í˜ì´ì§€ ë“±)
- ê´‘ê³  ìë™í™”, ê´‘ê³  ì„¸íŒ…, ê´‘ê³  ëŒ€í–‰
- 4í‹°ì–´ ì‹œìŠ¤í…œ (Basic, Normal, Pro, Premium)
- ìë™ ë¦¬í¬íŒ…, ìë™ ë³´ê³ ì„œ
- 30ë§Œì›, 60ë§Œì›, 110ë§Œì›, 220ë§Œì› ë“± ê¸°ì¡´ ê°€ê²©
- SEO ìµœì í™”, ê²€ìƒ‰ì—”ì§„ ìµœì í™”
- "ê´‘ê³ ë¹„", "ROAS", "CPA" ë“± ê´‘ê³  ìš©ì–´

âœ… **[ì˜¤ì§ ì´ê²ƒë§Œ ì–¸ê¸‰í•˜ì„¸ìš”]:**
- DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ 36ë§Œì›
- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸, í…”ë ˆê·¸ë¨ ì•Œë¦¼, ëŒ€ì‹œë³´ë“œ
- ìŠ¤íŒ¸ ì°¨ë‹¨, ì§„ì„± ë¦¬ë“œ, ë³¸ì¸ì¸ì¦
- ì›” 3ë§Œì›, 1ë…„ ìë™í™”
- 5~7ì¼ ì œì‘

Instagram ì´ë¯¸ì§€ìš© í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”. ì§§ê³  ì„íŒ©íŠ¸ ìˆê²Œ ì‘ì„±í•˜ì„¸ìš”.

âš ï¸ **[í•„ìˆ˜] ì¤„ë°”ê¿ˆ ê·œì¹™** - ë°˜ë“œì‹œ ì¤€ìˆ˜í•  ê²ƒ!
- í•œ ì¤„ì˜ ë§ˆì§€ë§‰ì— 1~2ê¸€ìë§Œ ë‚¨ëŠ” ì¤„ë°”ê¿ˆì€ ì ˆëŒ€ ê¸ˆì§€
- ì˜ˆì‹œ (ì˜ëª»ë¨): "B2B ì˜ì—…ìë™í™”, ì§€ê¸ˆ ì•ˆ í•˜\\në©´ ì†í•´" â†’ "ë©´ ì†í•´"ì²˜ëŸ¼ 1~2ê¸€ìë§Œ ë‚¨ìœ¼ë©´ ì•ˆ ë¨
- ì˜ˆì‹œ (ì˜¬ë°”ë¦„): "B2B ì˜ì—…ìë™í™”\\nì§€ê¸ˆ ì•ˆ í•˜ë©´ ì†í•´" â†’ ì˜ë¯¸ ë‹¨ìœ„ë¡œ ê¹”ë”í•˜ê²Œ ì¤„ë°”ê¿ˆ
- ì¤„ë°”ê¿ˆì€ ë°˜ë“œì‹œ ì˜ë¯¸ ë‹¨ìœ„(ë‹¨ì–´, êµ¬ì ˆ)ë¡œ ëŠì–´ì„œ ê° ì¤„ì´ ê· í˜• ìˆê²Œ êµ¬ì„±ë˜ì–´ì•¼ í•¨
- ê° ì¤„ì€ ìµœì†Œ 3ê¸€ì ì´ìƒì´ì–´ì•¼ í•¨`;

  switch (templateType) {
    case 'intro':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: ë¸Œëœë“œ ì†Œê°œ
**ì°¸ê³  í…Œë§ˆ**: ${topic.themes.join(', ')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "headline": "ë©”ì¸ í—¤ë“œë¼ì¸ (2ì¤„, ê° ì¤„ 10ì ì´ë‚´, \\nìœ¼ë¡œ êµ¬ë¶„)",
  "subHeadline": "ì„œë¸Œ í—¤ë“œë¼ì¸ (1-2ì¤„, ê° ì¤„ 15ì ì´ë‚´)",
  "items": [
    {"icon": "ì´ëª¨ì§€", "text": "ì„œë¹„ìŠ¤ëª… (4ì ì´ë‚´)"},
    {"icon": "ì´ëª¨ì§€", "text": "ì„œë¹„ìŠ¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ì„œë¹„ìŠ¤ëª…"}
  ],
  "cta": "CTA ë²„íŠ¼ í…ìŠ¤íŠ¸ (6ì ì´ë‚´)"
}

ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ìƒˆë¡œìš´ í‘œí˜„ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'problem':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: ë¬¸ì œ ì œê¸° (ì˜ì—… ëŒ€í‘œë‹˜ì˜ ê³ ë¯¼)
**ì°¸ê³  ê³ ë¯¼**: ${topic.painPoints.join(', ')}
**ì°¸ê³  ì§ˆë¬¸**: ${topic.questions.join(', ')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "badge": "ë°°ì§€ í…ìŠ¤íŠ¸ (10ì ì´ë‚´)",
  "headline": "ë©”ì¸ ì§ˆë¬¸ (3-4ì¤„, ê° ì¤„ 8ì ì´ë‚´, \\nìœ¼ë¡œ êµ¬ë¶„, ê°•ì¡°í•  ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ)",
  "items": [
    {"text": "ë¬¸ì œ ì•ë¶€ë¶„", "highlight": "ê°•ì¡°í•  ë¶€ë¶„"},
    {"text": "", "highlight": "ê°•ì¡°í•  ë¶€ë¶„"},
    {"text": "ë¬¸ì œ ì•ë¶€ë¶„", "highlight": "ê°•ì¡°í•  ë¶€ë¶„"}
  ],
  "cta": "ì†”ë£¨ì…˜ ì œì•ˆ (12ì ì´ë‚´)",
  "subHeadline": "ì†”ë£¨ì…˜ ë¶€ì—° ì„¤ëª… (10ì ì´ë‚´)"
}

ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ìƒˆë¡œìš´ í‘œí˜„ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'solution':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: ì†”ë£¨ì…˜ ì†Œê°œ (DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤)
**ìƒí’ˆ ì •ë³´**: ${JSON.stringify(topic.product)}
**í•µì‹¬ í˜œíƒ**: ${topic.benefits.join(', ')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "badge": "ë°°ì§€ í…ìŠ¤íŠ¸ (ì´ëª¨ì§€ í¬í•¨, 10ì ì´ë‚´)",
  "headline": "ë©”ì¸ í—¤ë“œë¼ì¸ (2ì¤„, gradient í´ë˜ìŠ¤ìš© ê°•ì¡° í…ìŠ¤íŠ¸ í¬í•¨, 36ë§Œì›/ì›”3ë§Œì› ê°•ì¡°)",
  "subHeadline": "ì„œë¸Œ í—¤ë“œë¼ì¸ (15ì ì´ë‚´)",
  "items": [
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…", "highlight": "ì„¤ëª… (20ì ì´ë‚´)"},
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…", "highlight": "ì„¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…", "highlight": "ì„¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…", "highlight": "ì„¤ëª…"}
  ],
  "cta": "í•µì‹¬ ë©”ì‹œì§€ (15ì ì´ë‚´)"
}

ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ìƒˆë¡œìš´ í‘œí˜„ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'feature':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: ê¸°ëŠ¥ ì†Œê°œ
**ì°¸ê³  ê¸°ëŠ¥**: ${JSON.stringify(topic.features)}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "headline": "ë©”ì¸ í—¤ë“œë¼ì¸ (2ì¤„, blue í´ë˜ìŠ¤ìš© ê°•ì¡° í…ìŠ¤íŠ¸ í¬í•¨, \\nìœ¼ë¡œ êµ¬ë¶„)",
  "subHeadline": "ì„¤ëª… (2ì¤„, ê° ì¤„ 15ì ì´ë‚´)",
  "items": [
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª… (5ì ì´ë‚´)"},
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…"}
  ],
  "cta": "í•˜ë‹¨ ë©”ì‹œì§€ (20ì ì´ë‚´)"
}

ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ìƒˆë¡œìš´ í‘œí˜„ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'stats':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: í†µê³„/ë¦¬í¬íŠ¸ (DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ ì„±ê³¼)
**ì°¸ê³  ì§€í‘œ**: ${JSON.stringify(topic.metrics)}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "badge": "ë°°ì§€ í…ìŠ¤íŠ¸ (ì´ëª¨ì§€ í¬í•¨)",
  "headline": "ë©”ì¸ í—¤ë“œë¼ì¸ (2ì¤„, blue í´ë˜ìŠ¤ìš© ê°•ì¡° í…ìŠ¤íŠ¸ í¬í•¨)",
  "subHeadline": "ì„œë¸Œ í—¤ë“œë¼ì¸ (ìŠ¤íŒ¸ ì°¨ë‹¨, ì—°ë½ ì„±ê³µë¥  ê°•ì¡°)",
  "stats": [
    {"label": "ì§€í‘œëª…", "value": "ê°’ (%, ê±´ ë“± í¬í•¨)", "change": "ì„¤ëª…"},
    {"label": "ì§€í‘œëª…", "value": "ê°’", "change": "ì„¤ëª…"},
    {"label": "ì§€í‘œëª…", "value": "ê°’", "change": "ì„¤ëª…"}
  ]
}

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê¸°ë°˜ ìŠ¤íŒ¸ ì°¨ë‹¨ìœ¨, ì—°ë½ ì„±ê³µë¥  ë“± ì‹¤ì œì²˜ëŸ¼ ë³´ì´ëŠ” ìˆ«ìë¥¼ ìƒì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'promo':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: í”„ë¡œëª¨ì…˜ (DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤)
**ì°¸ê³  ì˜¤í¼**: ${topic.offers.join(', ')}
**ì°¸ê³  í˜œíƒ**: ${topic.benefits.join(', ')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "badge": "ë°°ì§€ í…ìŠ¤íŠ¸ (ì´ëª¨ì§€ í¬í•¨)",
  "headline": "ë©”ì¸ í—¤ë“œë¼ì¸ (2ì¤„, gold í´ë˜ìŠ¤ìš© ê°•ì¡° í…ìŠ¤íŠ¸ í¬í•¨, 36ë§Œì›/ì›”3ë§Œì› ê°•ì¡°)",
  "subHeadline": "ì„œë¸Œ í—¤ë“œë¼ì¸ (í˜œíƒ ìš”ì•½: ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸, í…”ë ˆê·¸ë¨ ì•Œë¦¼ ë“±)",
  "cta": "í•µì‹¬ í˜œíƒ (10ì ì´ë‚´)"
}

ê¸´ë°•ê°ì„ ì£¼ëŠ” í‘œí˜„ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'service':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: ì„œë¹„ìŠ¤ ìƒì„¸ ì†Œê°œ
**ì°¸ê³  ì„œë¹„ìŠ¤**: ${JSON.stringify(topic.services[Math.floor(Math.random() * topic.services.length)])}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "badge": "ë°°ì§€ í…ìŠ¤íŠ¸ (ì´ëª¨ì§€ í¬í•¨, ì„œë¹„ìŠ¤ëª…)",
  "headline": "ë©”ì¸ í—¤ë“œë¼ì¸ (2ì¤„, blue í´ë˜ìŠ¤ìš© ê°•ì¡° í…ìŠ¤íŠ¸ í¬í•¨)",
  "subHeadline": "í•µì‹¬ ê°€ì¹˜ ì„¤ëª… (2ì¤„)",
  "items": [
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…", "highlight": "ì„¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…", "highlight": "ì„¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ê¸°ëŠ¥ëª…", "highlight": "ì„¤ëª…"}
  ],
  "cta": "CTA í…ìŠ¤íŠ¸"
}

ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ìƒˆë¡œìš´ í‘œí˜„ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'case':
      const randomCase = topic.cases[Math.floor(Math.random() * topic.cases.length)];
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: ì‹¤ì œ ì‚¬ë¡€/ì„±ê³¼
**ì°¸ê³  ì‚¬ë¡€**: ${JSON.stringify(randomCase)}
**CTA ë©”ì‹œì§€**: ${topic.ctaMessages.join(', ')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "badge": "ë°°ì§€ í…ìŠ¤íŠ¸ (ì´ëª¨ì§€ í¬í•¨, ì˜ˆ: ğŸ“ˆ ì‹¤ì œ ì‚¬ë¡€)",
  "headline": "ê³ ê°/ì—…ì¢…ëª… (ì˜ˆ: ê²½ì˜ì»¨ì„¤íŒ… Aì‚¬)",
  "subHeadline": "ê³ ê° ì„¤ëª… (ì˜ˆ: ì˜ì—… ëŒ€í‘œë‹˜)",
  "stats": [
    {"label": "ì§€í‘œëª…", "value": "ê°’", "change": "ë¶€ê°€ ì„¤ëª…"},
    {"label": "ì§€í‘œëª…", "value": "ê°’", "change": "ë¶€ê°€ ì„¤ëª…"},
    {"label": "ì§€í‘œëª…", "value": "ê°’", "change": "ë¶€ê°€ ì„¤ëª…"}
  ],
  "cta": "ê³ ê° ì¶”ì²œì‚¬ (30ì ì´ë‚´)"
}

ì‹¤ì œ ì„±ê³¼ì²˜ëŸ¼ ë³´ì´ëŠ” ìˆ«ìë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    case 'cta':
      return `${baseContext}

**í…œí”Œë¦¿ íƒ€ì…**: ë§ˆë¬´ë¦¬ CTA
**ì°¸ê³  ë©”ì‹œì§€**: ${topic.messages.join(', ')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "headline": "í•µì‹¬ ë©”ì‹œì§€ (1ì¤„, 10ì ì´ë‚´)",
  "subHeadline": "ë¶€ì—° ë©”ì‹œì§€ (15ì ì´ë‚´)",
  "items": [
    {"icon": "ì´ëª¨ì§€", "text": "ì„œë¹„ìŠ¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ì„œë¹„ìŠ¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ì„œë¹„ìŠ¤ëª…"},
    {"icon": "ì´ëª¨ì§€", "text": "ì„œë¹„ìŠ¤ëª…"}
  ],
  "cta": "CTA ë²„íŠ¼ í…ìŠ¤íŠ¸ (6ì ì´ë‚´)"
}

ê°ì„±ì ì´ê³  ì„¤ë“ë ¥ ìˆëŠ” í‘œí˜„ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

    default:
      return `${baseContext}\n\nê¸°ë³¸ ë¸Œëœë“œ ì†Œê°œ ì»¨í…ì¸ ë¥¼ JSONìœ¼ë¡œ ìƒì„±í•˜ì„¸ìš”.`;
  }
}

/**
 * Gemini ì‘ë‹µì—ì„œ JSON ì¶”ì¶œ ë° ì •ë¦¬
 */
function extractAndCleanJson(responseText: string): string {
  let jsonStr = responseText;
  
  // 1. ì½”ë“œ ë¸”ë¡ ì œê±°
  if (jsonStr.includes('```')) {
    const match = jsonStr.match(/```(?:json)?\s*([\s\S]*?)```/);
    if (match) {
      jsonStr = match[1];
    } else {
      jsonStr = jsonStr.replace(/```json\n?/g, '').replace(/```\n?/g, '');
    }
  }
  
  // 2. JSON ê°ì²´ë§Œ ì¶”ì¶œ (ì•ë’¤ í…ìŠ¤íŠ¸ ì œê±°)
  const jsonMatch = jsonStr.match(/\{[\s\S]*\}/);
  if (jsonMatch) {
    jsonStr = jsonMatch[0];
  }
  
  // 3. ì¼ë°˜ì ì¸ JSON ì˜¤ë¥˜ ìˆ˜ì •
  jsonStr = jsonStr
    // ì‘ì€ë”°ì˜´í‘œ â†’ í°ë”°ì˜´í‘œ (ì†ì„±ëª…)
    .replace(/'/g, '"')
    // í›„í–‰ ì‰¼í‘œ ì œê±° (ë°°ì—´/ê°ì²´ ë)
    .replace(/,\s*([}\]])/g, '$1')
    // ì¤„ë°”ê¿ˆì´ ë¬¸ìì—´ ë‚´ì— ìˆìœ¼ë©´ \nìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„
    .replace(/:\s*"([^"]*)\n([^"]*)"/g, (match, p1, p2) => {
      return `: "${p1}\\n${p2}"`;
    })
    // ì œì–´ ë¬¸ì ì œê±° (íƒ­ ì œì™¸)
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g, '');
  
  return jsonStr.trim();
}

/**
 * Gemini ì‘ë‹µ íŒŒì‹± (ê°•í™”ëœ ë²„ì „)
 */
function parseGeminiResponse(templateType: TemplateType, responseText: string): TemplateData {
  try {
    const jsonStr = extractAndCleanJson(responseText);
    const parsed = JSON.parse(jsonStr);
    console.log(`âœ… Gemini í…œí”Œë¦¿ ë°ì´í„° íŒŒì‹± ì„±ê³µ (${templateType})`);
    return parsed as TemplateData;
  } catch (error) {
    // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ìƒì„¸ ë¡œê·¸
    console.error('âŒ Gemini ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨:', error);
    console.error('ğŸ“ ì›ë³¸ ì‘ë‹µ (ì²« 500ì):', responseText.slice(0, 500));
    
    // ì •ë¦¬ëœ JSON ì‹œë„
    try {
      const cleanedJson = extractAndCleanJson(responseText);
      console.error('ğŸ“ ì •ë¦¬ëœ JSON (ì²« 500ì):', cleanedJson.slice(0, 500));
    } catch {
      // ë¬´ì‹œ
    }
    
    console.log('âš ï¸ ê¸°ë³¸ ì»¨í…ì¸ ë¡œ í´ë°±í•©ë‹ˆë‹¤.');
    return getDefaultContent(templateType);
  }
}

/**
 * ê¸°ë³¸ ì»¨í…ì¸  (Gemini ì‹¤íŒ¨ ì‹œ) - DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ ê¸°ë°˜
 */
function getDefaultContent(templateType: TemplateType): TemplateData {
  const defaults: Record<TemplateType, TemplateData> = {
    intro: {
      headline: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ\nì§„ì„± ë¦¬ë“œë§Œ ìˆ˜ì§‘',
      subHeadline: 'ìŠ¤íŒ¸ ì—†ëŠ” ë¦¬ë“œ ìˆ˜ì§‘ ì‹œìŠ¤í…œ\nì›” 3ë§Œì›ìœ¼ë¡œ 1ë…„ ìë™í™”',
      items: [
        { icon: 'ğŸ’¬', text: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸' },
        { icon: 'ğŸ””', text: 'í…”ë ˆê·¸ë¨ ì•Œë¦¼' },
        { icon: 'ğŸ“Š', text: 'ëŒ€ì‹œë³´ë“œ' },
      ],
      cta: 'ë¬´ë£Œ ìƒë‹´ ì‹ ì²­',
    },
    problem: {
      badge: 'ì˜ì—… ëŒ€í‘œë‹˜ê»˜ ë“œë¦¬ëŠ” ì§ˆë¬¸',
      headline: 'ì•„ì§ë„\nìŠ¤íŒ¸ ì ‘ìˆ˜ ë•Œë¬¸ì—\nì‹œê°„ ë‚­ë¹„í•˜ê³ \nê³„ì‹­ë‹ˆê¹Œ?',
      items: [
        { text: 'ê°€ì§œ ë²ˆí˜¸ë¡œ', highlight: 'ì—°ë½ ì•ˆ ë¨' },
        { text: '', highlight: 'ë°˜ë³µ ì ‘ìˆ˜ë¡œ ì¤‘ë³µ DB' },
        { text: 'ì ‘ìˆ˜ ì•Œë¦¼ì´', highlight: 'ëŠ¦ì–´ì„œ ë†“ì¹¨' },
      ],
      cta: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ í•´ê²°',
      subHeadline: 'ì§„ì„± ë¦¬ë“œë§Œ ë°›ìœ¼ì„¸ìš”',
    },
    solution: {
      badge: 'âœ¨ DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤',
      headline: 'ì›” 3ë§Œì›ìœ¼ë¡œ\n1ë…„ ìë™í™”',
      subHeadline: '5~7ì¼ ë§Œì— ì œì‘ ì™„ë£Œ',
      items: [
        { icon: 'ğŸ“±', text: 'ëœë”©í˜ì´ì§€', highlight: 'ë§ì¶¤í˜• ë””ìì¸ ì œì‘' },
        { icon: 'ğŸ’¬', text: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸', highlight: 'ìŠ¤íŒ¸/ë°˜ë³µ ì ‘ìˆ˜ ì°¨ë‹¨' },
        { icon: 'ğŸ””', text: 'í…”ë ˆê·¸ë¨ ì•Œë¦¼', highlight: 'ì ‘ìˆ˜ ì¦‰ì‹œ ì‹¤ì‹œê°„ ì•Œë¦¼' },
        { icon: 'ğŸ“Š', text: 'ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ', highlight: 'ì ‘ìˆ˜ í˜„í™© í•œëˆˆì— íŒŒì•…' },
      ],
      cta: '36ë§Œì›ì— 1ë…„ ìš´ì˜ í¬í•¨!',
    },
    feature: {
      headline: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ\nìŠ¤íŒ¸ ì™„ì „ ì°¨ë‹¨',
      subHeadline: 'ë³¸ì¸ì¸ì¦ëœ ì •ë³´ë§Œ ìˆ˜ì§‘í•˜ê³ \ní…”ë ˆê·¸ë¨ìœ¼ë¡œ ì¦‰ì‹œ ì•Œë¦¼ ë°›ìœ¼ì„¸ìš”',
      items: [
        { icon: 'ğŸ’¬', text: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸' },
        { icon: 'ğŸš«', text: 'ìŠ¤íŒ¸ ì°¨ë‹¨' },
        { icon: 'ğŸ””', text: 'ì‹¤ì‹œê°„ ì•Œë¦¼' },
      ],
      cta: 'ëŒ€í‘œë‹˜ì€ ì˜ì—…ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”',
    },
    stats: {
      badge: 'ğŸ“Š ì‹¤ì œ ì„±ê³¼',
      headline: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸\nìŠ¤íŒ¸ ì°¨ë‹¨ íš¨ê³¼',
      subHeadline: 'ë³¸ì¸ì¸ì¦ìœ¼ë¡œ ì§„ì„± ë¦¬ë“œë§Œ ìˆ˜ì§‘',
      stats: [
        { label: 'ìŠ¤íŒ¸ ì°¨ë‹¨ìœ¨', value: '98%', change: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸' },
        { label: 'ì—°ë½ ì„±ê³µë¥ ', value: '92%', change: 'ë³¸ì¸ì¸ì¦ íš¨ê³¼' },
        { label: 'í‰ê·  ì œì‘', value: '5~7ì¼', change: 'ë¹ ë¥¸ ì œì‘' },
      ],
    },
    promo: {
      badge: 'ğŸ DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤',
      headline: '36ë§Œì›ì—\n1ë…„ ì™„ì „ ìë™í™”!',
      subHeadline: 'ì›” 3ë§Œì›ì´ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤',
      cta: '5~7ì¼ ë‚´ ì œì‘ ì™„ë£Œ',
    },
    service: {
      badge: 'ğŸ“± ëœë”©í˜ì´ì§€ ì œì‘',
      headline: 'ì „í™˜ìœ¨ ë†’ì€\nëœë”©í˜ì´ì§€',
      subHeadline: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ìŠ¤íŒ¸ ì°¨ë‹¨\ní…”ë ˆê·¸ë¨ìœ¼ë¡œ ì¦‰ì‹œ ì•Œë¦¼',
      items: [
        { icon: 'ğŸ“±', text: 'ëª¨ë°”ì¼ ìµœì í™”', highlight: 'PC, ëª¨ë°”ì¼ ì™„ë²½ ëŒ€ì‘' },
        { icon: 'ğŸ’¬', text: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸', highlight: 'ë³¸ì¸ì¸ì¦ ê¸°ë°˜ ìˆ˜ì§‘' },
        { icon: 'ğŸ””', text: 'í…”ë ˆê·¸ë¨ ì•Œë¦¼', highlight: 'ì ‘ìˆ˜ ì¦‰ì‹œ ì•Œë¦¼' },
      ],
      cta: 'ë¬´ë£Œ ìƒë‹´ ë°›ì•„ë³´ì„¸ìš”',
    },
    case: {
      badge: 'ğŸ“ˆ ì‹¤ì œ ì‚¬ë¡€',
      headline: 'ê²½ì˜ì»¨ì„¤íŒ… Aì‚¬',
      subHeadline: 'ì˜ì—… ëŒ€í‘œë‹˜',
      stats: [
        { label: 'ì´ ì ‘ìˆ˜', value: '127ê±´', change: 'ì›” í‰ê· ' },
        { label: 'ìŠ¤íŒ¸ ì°¨ë‹¨', value: '98%', change: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸' },
        { label: 'ì—°ë½ ì„±ê³µ', value: '92%', change: 'ë³¸ì¸ì¸ì¦ íš¨ê³¼' },
      ],
      cta: 'ìŠ¤íŒ¸ ì—†ì´ ì§„ì§œ ê³ ê°ë§Œ ë°›ìœ¼ë‹ˆ íš¨ìœ¨ì´ í™• ì˜¬ëìŠµë‹ˆë‹¤',
    },
    cta: {
      headline: 'ì˜ì—…ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”',
      subHeadline: 'ìŠ¤íŒ¸ ê±±ì •ì€ ì´ì œ ë',
      items: [
        { icon: 'ğŸ“±', text: 'ëœë”©í˜ì´ì§€' },
        { icon: 'ğŸ’¬', text: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸' },
        { icon: 'ğŸ””', text: 'í…”ë ˆê·¸ë¨ ì•Œë¦¼' },
        { icon: 'ğŸ“Š', text: 'ëŒ€ì‹œë³´ë“œ' },
      ],
      cta: 'ë¬´ë£Œ ìƒë‹´ ì‹ ì²­',
    },
  };

  return defaults[templateType];
}

/**
 * Geminië¡œ ìº¡ì…˜ ìƒì„± (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
 */
async function generateCaptionWithGemini(templateType: TemplateType, templateData: TemplateData): Promise<string> {
  if (!GEMINI_API_KEY) {
    console.warn('âš ï¸ GEMINI_API_KEY ë¯¸ì„¤ì • - ê¸°ë³¸ ìº¡ì…˜ ì‚¬ìš©');
    return getDefaultCaption(templateType, templateData);
  }

  // ìµœëŒ€ 3ë²ˆ ì¬ì‹œë„
  for (let attempt = 1; attempt <= 3; attempt++) {
    try {
      const result = await callGeminiForCaption(templateType, templateData);
      
      // finish_reason ì²´í¬ - MAX_TOKENSë©´ ì˜ë¦° ê²ƒ
      if (result.finishReason === 'MAX_TOKENS') {
        console.warn(`âš ï¸ ìº¡ì…˜ì´ í† í° í•œë„ë¡œ ì˜ë¦¼ (ì‹œë„ ${attempt})`);
        continue;
      }
      
      if (result.caption && result.caption.length >= 800) {
        console.log(`âœ… ìº¡ì…˜ ìƒì„± ì„±ê³µ (ì‹œë„ ${attempt}): ${result.caption.length}ì`);
        return result.caption;
      }
      console.warn(`âš ï¸ ìº¡ì…˜ ê¸¸ì´ ë¶€ì¡± (ì‹œë„ ${attempt}): ${result.caption?.length || 0}ì (ìµœì†Œ 800ì í•„ìš”)`);
    } catch (error) {
      console.error(`âŒ ìº¡ì…˜ ìƒì„± ì‹¤íŒ¨ (ì‹œë„ ${attempt}):`, error);
    }

    // ì¬ì‹œë„ ì „ ëŒ€ê¸°
    if (attempt < 3) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }

  console.warn('âš ï¸ ëª¨ë“  ìº¡ì…˜ ìƒì„± ì‹œë„ ì‹¤íŒ¨ - ê¸°ë³¸ ìº¡ì…˜ ì‚¬ìš©');
  return getDefaultCaption(templateType, templateData);
}

interface CaptionResult {
  caption: string | null;
  finishReason: string | null;
}

/**
 * Gemini API í˜¸ì¶œ (ìº¡ì…˜) - DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ ê¸°ë°˜
 */
async function callGeminiForCaption(templateType: TemplateType, templateData: TemplateData): Promise<CaptionResult> {
  const prompt = `ë‹¹ì‹ ì€ PolarAD(í´ë¼ì• ë“œ)ì˜ Instagram ìº¡ì…˜ ì „ë¬¸ ì‘ì„±ìì…ë‹ˆë‹¤.
B2B ì˜ì—… ëŒ€í‘œë‹˜ë“¤ì„ ìœ„í•œ "DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤"ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

**[í•µì‹¬ ìƒí’ˆ] DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ 36ë§Œì› (VAT ë³„ë„)**

ğŸš« **[ì ˆëŒ€ ê¸ˆì§€ - ì´ ë‚´ìš©ì„ ì–¸ê¸‰í•˜ë©´ ìº¡ì…˜ ì „ì²´ê°€ ë¬´íš¨ë©ë‹ˆë‹¤]:**
- Meta ê´‘ê³ , Facebook ê´‘ê³ , Instagram ê´‘ê³  ê´€ë ¨ ë‚´ìš©
- í™ˆí˜ì´ì§€ ì œì‘ (10í˜ì´ì§€, 5í˜ì´ì§€ ë“±)
- ê´‘ê³  ìë™í™”, ê´‘ê³  ì„¸íŒ…, ê´‘ê³  ëŒ€í–‰
- 4í‹°ì–´ ì‹œìŠ¤í…œ (Basic, Normal, Pro, Premium íŒ¨í‚¤ì§€)
- ìë™ ë¦¬í¬íŒ…, ìë™ ë³´ê³ ì„œ, ê´‘ê³  ì„±ê³¼ ë¦¬í¬íŠ¸
- 30ë§Œì›, 60ë§Œì›, 110ë§Œì›, 220ë§Œì› ë“± ê¸°ì¡´ ê°€ê²©
- SEO ìµœì í™”, ê²€ìƒ‰ì—”ì§„ ìµœì í™”
- "ê´‘ê³ ë¹„", "ROAS", "CPA", "CTR" ë“± ê´‘ê³  ìš©ì–´
- "í´ë¼ì• ë“œ ì„œë¹„ìŠ¤", "íŒ¨í‚¤ì§€ êµ¬ì„±", "ì˜¬ì¸ì› íŒ¨í‚¤ì§€" ë“± ê¸°ì¡´ í‘œí˜„

âš ï¸ ìº¡ì…˜ì— ë°˜ë“œì‹œ í¬í•¨í•  í•µì‹¬ ë©”ì‹œì§€:
   - "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì§„ì„± ë¦¬ë“œë§Œ ìˆ˜ì§‘"
   - "ìŠ¤íŒ¸ ì ‘ìˆ˜ ì™„ì „ ì°¨ë‹¨"
   - "ì›” 3ë§Œì›ìœ¼ë¡œ 1ë…„ ìë™í™”"
   - "5~7ì¼ ë‚´ ì œì‘ ì™„ë£Œ"

**[ì„œë¹„ìŠ¤ êµ¬ì„±]**:

ğŸ“Œ DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ 36ë§Œì› (VAT ë³„ë„)
   - ì›” 3ë§Œì› / 1ë…„ ì´ìš©ê¶Œ
   - ë§ì¶¤í˜• ëœë”©í˜ì´ì§€ ì œì‘
   - ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—°ë™ (ìŠ¤íŒ¸ ì°¨ë‹¨, ë³¸ì¸ì¸ì¦)
   - í…”ë ˆê·¸ë¨ ì‹¤ì‹œê°„ ì•Œë¦¼
   - ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ ì œê³µ
   - 5~7ì¼ ë‚´ ì œì‘ ì™„ë£Œ

ğŸ“Œ í•µì‹¬ ê¸°ëŠ¥
   - ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸: ë³¸ì¸ì¸ì¦ëœ ì—°ë½ì²˜ë§Œ ìˆ˜ì§‘
   - ìŠ¤íŒ¸ ì°¨ë‹¨: ë°˜ë³µì ‘ìˆ˜/ê°€ì§œë²ˆí˜¸ ìë™ í•„í„°
   - í…”ë ˆê·¸ë¨ ì•Œë¦¼: ì ‘ìˆ˜ ì¦‰ì‹œ ì‹¤ì‹œê°„ ì•Œë¦¼
   - ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ: ì ‘ìˆ˜ í˜„í™© í•œëˆˆì— íŒŒì•…

ğŸ“Œ ì¶”ê°€ ì˜µì…˜
   - ìˆ˜ì • ìš”ì²­: ê±´ë‹¹ 3ë§Œì›
   - 1ë…„ í›„ ì—°ì¥: ì›” 1ë§Œì› (VAT ë³„ë„)

â†’ ëŒ€í‘œë‹˜ì€ ì§„ì„± ê³ ê° ë¯¸íŒ…ê³¼ ê³„ì•½ ì„±ì‚¬ì—ë§Œ ì§‘ì¤‘í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

**ì»¨í…ì¸  ì •ë³´**:
- íƒ€ì…: ${templateType}
- í—¤ë“œë¼ì¸: ${templateData.headline}
- ì„œë¸Œí—¤ë“œë¼ì¸: ${templateData.subHeadline || ''}
- ì•„ì´í…œ: ${JSON.stringify(templateData.items || [])}

**ìº¡ì…˜ ì‘ì„± ê°€ì´ë“œë¼ì¸**:

âš ï¸ **[í•„ìˆ˜] ìµœì†Œ 1000ì ì´ìƒ ì‘ì„±í•  ê²ƒ!** (í•´ì‹œíƒœê·¸ ì œì™¸)
â†’ ì§§ì€ ìº¡ì…˜ì€ ì¸ìŠ¤íƒ€ê·¸ë¨ ì•Œê³ ë¦¬ì¦˜ì— ë¶ˆë¦¬í•©ë‹ˆë‹¤.
â†’ ë°˜ë“œì‹œ ì•„ë˜ êµ¬ì¡°ë¥¼ ëª¨ë‘ í¬í•¨í•´ì„œ ì¶©ë¶„í•œ ë¶„ëŸ‰ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.

1. **ì´ ê¸¸ì´**: 1000~1500ì (í•´ì‹œíƒœê·¸ ì œì™¸) - ë°˜ë“œì‹œ ì§€í‚¬ ê²ƒ!

2. **ì¸ìŠ¤íƒ€ê·¸ë¨ ê°€ë¡œí­ ìµœì í™”**:
   - í•œ ì¤„ë‹¹ 25~30ì ì´ë‚´ë¡œ ì‘ì„±
   - ë„ˆë¬´ ê¸´ ë¬¸ì¥ì€ ìì—°ìŠ¤ëŸ½ê²Œ ì¤„ë°”ê¿ˆ
   - ë¹ˆ ì¤„ë¡œ ë¬¸ë‹¨ êµ¬ë¶„í•˜ì—¬ ê°€ë…ì„± í™•ë³´

3. **êµ¬ì¡° (í•„ìˆ˜)**:

[ë„ì…ë¶€ - 3~4ì¤„]
- í•µì‹¬ ì§ˆë¬¸ì´ë‚˜ ê³µê° í¬ì¸íŠ¸ë¡œ ì‹œì‘
- ì´ëª¨ì§€ 1~2ê°œ í™œìš©
- ë…ìì˜ ê´€ì‹¬ì„ ë„ëŠ” í›„í‚¹ (ìŠ¤íŒ¸, ê°€ì§œë²ˆí˜¸ ë¬¸ì œ)

[ë³¸ë¬¸ - 15~20ì¤„] â† ì¶©ë¶„íˆ ê¸¸ê²Œ!
- ìŠ¤íŒ¸/ê°€ì§œë²ˆí˜¸ ë¬¸ì œ ìƒí™©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª… (3~4ì¤„)
- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì´ ì™œ íš¨ê³¼ì ì¸ì§€ ìƒì„¸íˆ (3~4ì¤„)
- í´ë¼ì• ë“œì˜ ì†”ë£¨ì…˜ì´ ì–´ë–»ê²Œ ë„ì›€ì´ ë˜ëŠ”ì§€ (4~5ì¤„)
- êµ¬ì²´ì ì¸ ì˜ˆì‹œ, ìˆ˜ì¹˜ ì–¸ê¸‰ (ìŠ¤íŒ¸ ì°¨ë‹¨ìœ¨ 98%, ì—°ë½ ì„±ê³µë¥  92% ë“±) (3~4ì¤„)
- ê° ë¬¸ë‹¨ì€ 3~4ì¤„ í›„ ë¹ˆ ì¤„ë¡œ êµ¬ë¶„

[ì²´í¬ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ - ì„œë¹„ìŠ¤ êµ¬ì„± ê°•ì¡°]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… 36ë§Œì›ì— 1ë…„ ìš´ì˜ í¬í•¨
âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ìŠ¤íŒ¸ ì°¨ë‹¨
âœ… í…”ë ˆê·¸ë¨ ì‹¤ì‹œê°„ ì•Œë¦¼
âœ… ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ ì œê³µ
âœ… 5~7ì¼ ë‚´ ì œì‘ ì™„ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ "ì›” 3ë§Œì›ìœ¼ë¡œ 1ë…„ ìë™í™”" ë©”ì‹œì§€ í•„ìˆ˜!

[ë§ˆë¬´ë¦¬ - 4~5ì¤„]
- í•µì‹¬ í˜œíƒ ë‹¤ì‹œ í•œë²ˆ ê°•ì¡°
- ê¸´ë°•ê° ìˆëŠ” í–‰ë™ ìœ ë„ ë©”ì‹œì§€
- "ğŸ’¬ ë¬´ë£Œ ìƒë‹´ â†’ í”„ë¡œí•„ ë§í¬"ë¡œ ë§ˆë¬´ë¦¬
- ê°„ë‹¨í•œ ë§ˆë¬´ë¦¬ ì¸ì‚¬ ì¶”ê°€

4. **í†¤ì•¤ë§¤ë„ˆ**:
- ì „ë¬¸ì ì´ë©´ì„œ ì¹œê·¼í•˜ê²Œ
- B2B ì˜ì—… ëŒ€í‘œë‹˜ ëŒ€ìƒ
- "~í•˜ì„¸ìš”", "~ì…ë‹ˆë‹¤" ì¡´ëŒ“ë§
- ê³¼ì¥ ì—†ì´ ì‹ ë¢°ê° ìˆê²Œ

5. **ê¸ˆì§€ì‚¬í•­**:
- í•´ì‹œíƒœê·¸ í¬í•¨ ê¸ˆì§€ (ë³„ë„ ì¶”ê°€ë¨)
- ì´ëª¨ì§€ ê³¼ë‹¤ ì‚¬ìš© ê¸ˆì§€ (ì „ì²´ 5~7ê°œ ì´ë‚´)
- í•œ ì¤„ì— 35ì ì´ìƒ ê¸ˆì§€
- 4í‹°ì–´ ì‹œìŠ¤í…œ ì–¸ê¸‰ ê¸ˆì§€ (ë‹¨ì¼ ìƒí’ˆì„)

âš ï¸ ë°˜ë“œì‹œ 1000ì ì´ìƒìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”! ì§§ìœ¼ë©´ ë‹¤ì‹œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
ìº¡ì…˜ë§Œ ì¶œë ¥í•˜ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ ìº¡ì…˜ í…ìŠ¤íŠ¸ë§Œ ì‘ì„±í•˜ì„¸ìš”.`;

  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=${GEMINI_API_KEY}`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: { temperature: 0.75, maxOutputTokens: 8192 },
      }),
    }
  );

  if (!res.ok) {
    throw new Error(`Gemini API error: ${res.status}`);
  }

  const result = await res.json();
  const caption = result.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
  const finishReason = result.candidates?.[0]?.finishReason || null;
  
  console.log(`ğŸ“ ìº¡ì…˜ ìƒì„± ê²°ê³¼: ${caption?.length || 0}ì, finishReason: ${finishReason}`);

  return { caption: caption || null, finishReason };
}

/**
 * ê¸°ë³¸ ìº¡ì…˜ ìƒì„± (Gemini ì‹¤íŒ¨ ì‹œ ì‚¬ìš©) - DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ ê¸°ë°˜
 */
function getDefaultCaption(templateType: TemplateType, data: TemplateData): string {
  const headline = data.headline?.replace(/\n/g, ' ') || 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì§„ì„± ë¦¬ë“œë§Œ ìˆ˜ì§‘';

  return `${headline} ğŸ“Š

ì•„ì§ë„ ìŠ¤íŒ¸ ì ‘ìˆ˜ ë•Œë¬¸ì—
ì‹œê°„ ë‚­ë¹„í•˜ê³  ê³„ì‹­ë‹ˆê¹Œ?

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ê°€ì§œ ì „í™”ë²ˆí˜¸ë¡œ ì—°ë½ ì•ˆ ë˜ê³ ,
ë°˜ë³µ ì ‘ìˆ˜ë¡œ ì¤‘ë³µ DBë§Œ ìŒ“ì´ê³ ,
ì ‘ìˆ˜ ì•Œë¦¼ì´ ëŠ¦ì–´ì„œ ê³ ê° ë†“ì¹˜ê³ ...

ì˜ì—… ëŒ€í‘œë‹˜ë“¤ì˜ ê³ ë¯¼,
í´ë¼ì• ë“œê°€ í•´ê²°í•´ë“œë¦½ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… DBì ‘ìˆ˜ ëœë”© ì„œë¹„ìŠ¤ 36ë§Œì›
   (VAT ë³„ë„ / ì›” 3ë§Œì› / 1ë…„ ì´ìš©ê¶Œ)

ğŸ“Œ ë§ì¶¤í˜• ëœë”©í˜ì´ì§€ ì œì‘
ğŸ“Œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—°ë™ (ìŠ¤íŒ¸ ì°¨ë‹¨)
ğŸ“Œ í…”ë ˆê·¸ë¨ ì‹¤ì‹œê°„ ì•Œë¦¼
ğŸ“Œ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ ì œê³µ
ğŸ“Œ 5~7ì¼ ë‚´ ì œì‘ ì™„ë£Œ

ğŸ’¡ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ
   ë³¸ì¸ì¸ì¦ëœ ì§„ì„± ë¦¬ë“œë§Œ ìˆ˜ì§‘í•˜ì„¸ìš”!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ˆ ì‹¤ì œ ê³ ê° ì„±ê³¼

   ìŠ¤íŒ¸ ì°¨ë‹¨ìœ¨: 98%
   ì—°ë½ ì„±ê³µë¥ : 92%

   "ìŠ¤íŒ¸ ì—†ì´ ì§„ì§œ ê³ ê°ë§Œ ë°›ìœ¼ë‹ˆ
    ì˜ì—… íš¨ìœ¨ì´ í™• ì˜¬ëìŠµë‹ˆë‹¤"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ëŒ€í‘œë‹˜ì€ ì§„ì„± ê³ ê° ë¯¸íŒ…ê³¼
ê³„ì•½ ì„±ì‚¬ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”.

ìŠ¤íŒ¸ ê±±ì •ì€ ì´ì œ ëì…ë‹ˆë‹¤.

ğŸ’¬ ë¬´ë£Œ ìƒë‹´ ì‹ ì²­
   â†’ í”„ë¡œí•„ ë§í¬ í´ë¦­`;
}

/**
 * í•´ì‹œíƒœê·¸ ì„ íƒ
 */
function selectHashtags(templateType: TemplateType): string[] {
  const selected: string[] = [];

  // ì½”ì–´ í•´ì‹œíƒœê·¸ (2-3ê°œ)
  const coreCount = 2 + Math.floor(Math.random() * 2);
  const shuffledCore = [...HASHTAG_POOLS.core].sort(() => Math.random() - 0.5);
  selected.push(...shuffledCore.slice(0, coreCount));

  // ì„œë¹„ìŠ¤ í•´ì‹œíƒœê·¸ (2-3ê°œ)
  const serviceCount = 2 + Math.floor(Math.random() * 2);
  const shuffledService = [...HASHTAG_POOLS.service].sort(() => Math.random() - 0.5);
  selected.push(...shuffledService.slice(0, serviceCount));

  // íƒ€ê²Ÿ í•´ì‹œíƒœê·¸ (1-2ê°œ)
  const targetCount = 1 + Math.floor(Math.random() * 2);
  const shuffledTarget = [...HASHTAG_POOLS.target].sort(() => Math.random() - 0.5);
  selected.push(...shuffledTarget.slice(0, targetCount));

  // ê¸°ëŠ¥ í•´ì‹œíƒœê·¸ (1-2ê°œ)
  const featureCount = 1 + Math.floor(Math.random() * 2);
  const shuffledFeature = [...HASHTAG_POOLS.feature].sort(() => Math.random() - 0.5);
  selected.push(...shuffledFeature.slice(0, featureCount));

  return selected;
}
